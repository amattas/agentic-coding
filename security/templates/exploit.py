#!/usr/bin/env python3
"""
CTF Exploit Template
Challenge: [CHALLENGE NAME]
Category: Binary Exploitation
"""
from pwn import *

# Configuration
context.arch = 'amd64'  # or 'i386'
context.os = 'linux'
# context.log_level = 'debug'

EXECUTABLE = "./target"
HOST = "localhost"
PORT = 9999
ENV = {}

# Connection setup
def conn():
    if args.REMOTE:
        return remote(HOST, PORT)
    elif args.GDB:
        return gdb.debug([EXECUTABLE], env=ENV, gdbscript='''
            b *main
            c
        ''')
    else:
        return process([EXECUTABLE], env=ENV)

# Main exploit
def main():
    p = conn()

    # ELF setup
    elf = ELF(EXECUTABLE)
    # libc = ELF('./libc.so.6')

    # Key addresses
    # main = elf.symbols['main']
    # win = elf.symbols['win']

    # Gadgets (from ropper)
    # pop_rdi = 0x401234
    # ret = 0x40101a

    # Offsets
    offset = 72  # TODO: Find actual offset

    # Build payload
    payload = b'A' * offset
    # payload += p64(ret)        # Stack alignment
    # payload += p64(pop_rdi)
    # payload += p64(arg)
    # payload += p64(win)

    # Send payload
    p.sendlineafter(b'> ', payload)

    # Get flag
    p.interactive()

if __name__ == '__main__':
    main()
